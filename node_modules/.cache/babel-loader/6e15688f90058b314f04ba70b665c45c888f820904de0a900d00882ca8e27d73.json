{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport Table from '/src/components/Table.vue';\nimport PieChart from '/src/components/PieChart.vue';\nimport LineChart from '/src/components/LineChart.vue';\nimport axios from 'axios';\nexport default {\n  name: 'Assets',\n  components: {\n    Table,\n    PieChart,\n    LineChart\n  },\n  data() {\n    return {\n      tableData: [],\n      totalValue: null,\n      pieChartValues: [],\n      pieChartLabels: [],\n      lineChartData: [{\n        name: 'Total Assets',\n        data: []\n      }]\n    };\n  },\n  mounted() {\n    this.loadData();\n  },\n  methods: {\n    async loadData() {\n      this.totalValue = null;\n      this.lineChartData[0].data = [];\n      this.pieChartValues = [];\n      this.pieChartLabels = [];\n      axios.get(`http://localhost:3000/api/assets`).then(resp => {\n        let assetData = resp.data;\n        this.tableData = assetData.filter(e => e.is_deleted == 0);\n        if (assetData.length) {\n          this.totalValue = 0;\n          for (let asset of assetData) {\n            if (!asset.is_deleted) {\n              this.pieChartLabels.push(asset.name);\n              this.pieChartValues.push(parseFloat(asset.value));\n              this.totalValue += parseFloat(asset.value);\n            }\n          }\n        }\n        this.$store.commit('setTotalAssetValue', this.totalValue);\n        axios.get(`http://localhost:3000/api/assets/history`).then(resp => {\n          this.refineAssets(assetData, resp.data);\n        });\n      }).catch(() => {\n        this.$router.push('/404');\n      });\n    },\n    refineAssets(assetData, history) {\n      // Get all individual assets\n      let assets = [];\n      for (let asset of assetData) {\n        assets.push({\n          id: asset.id,\n          history: []\n        });\n      }\n\n      // Get all dates that there are records for\n      let uniqueDates = [];\n      for (let entry of history) {\n        if (!uniqueDates.includes(entry.date)) {\n          uniqueDates.push(entry.date);\n        }\n      }\n      uniqueDates = uniqueDates.sort();\n\n      // Go through every asset\n      for (let asset of assets) {\n        for (let date of uniqueDates) {\n          // Check if there is any value for that asset on that date, add it if there is.\n          for (let entry of history) {\n            if (entry.date == date && entry.asset_id == asset.id) {\n              asset.history.push({\n                x: entry.date,\n                y: parseFloat(entry.value)\n              });\n            }\n          }\n          // If the asset doesn't have an entry for a date with data, add one with the previous value.\n          if (!asset.history.some(e => e.x == date)) {\n            if (asset.history.length) {\n              asset.history.push({\n                x: date,\n                y: parseFloat(asset.history[asset.history.length - 1].y)\n              });\n            }\n          }\n        }\n      }\n\n      // Turn the asset data into something the line chart can read\n      for (let asset of assets) {\n        for (let entry of asset.history) {\n          let i = this.lineChartData[0].data.findIndex(e => e.x == entry.x);\n          if (i < 0) {\n            this.lineChartData[0].data.push(entry);\n          } else {\n            this.lineChartData[0].data[i].y += entry.y;\n          }\n        }\n      }\n    }\n  }\n};","map":{"version":3,"names":["Table","PieChart","LineChart","axios","name","components","data","tableData","totalValue","pieChartValues","pieChartLabels","lineChartData","mounted","loadData","methods","get","then","resp","assetData","filter","e","is_deleted","length","asset","push","parseFloat","value","$store","commit","refineAssets","catch","$router","history","assets","id","uniqueDates","entry","includes","date","sort","asset_id","x","y","some","i","findIndex"],"sources":["src/components/Assets.vue"],"sourcesContent":["<template>\r\n    <v-row class=\"ma-2\">\r\n        <v-flex xs12>\r\n            <LineChart :theme=\"$vuetify.theme.themes.light.primary\" :series=\"lineChartData\"/>\r\n        </v-flex>\r\n\r\n        <v-flex xs12 md6>\r\n            <Table type=\"Asset\" url=\"assets\" :tableData=\"tableData\" :totalValue=\"totalValue\"/>\r\n        </v-flex>\r\n\r\n        <v-flex xs12 md6>\r\n            <PieChart type=\"Asset\" :series=\"pieChartValues\" :labels=\"pieChartLabels\"/>\r\n        </v-flex>\r\n    </v-row>\r\n</template>\r\n\r\n<script>\r\nimport Table from '/src/components/Table.vue'\r\nimport PieChart from '/src/components/PieChart.vue'\r\nimport LineChart from '/src/components/LineChart.vue'\r\nimport axios from 'axios'\r\n\r\nexport default ({\r\n    name: 'Assets',\r\n    components: {\r\n        Table,\r\n        PieChart,\r\n        LineChart,\r\n    },\r\n\r\n    data() {\r\n        return {\r\n            tableData: [],\r\n\r\n            totalValue: null,\r\n\r\n            pieChartValues: [],\r\n            pieChartLabels: [],\r\n\r\n            lineChartData: [{\r\n                name: 'Total Assets',\r\n                data: []\r\n            }],\r\n        }\r\n    },\r\n\r\n    mounted() {\r\n        this.loadData()\r\n    },\r\n\r\n    methods: {\r\n        async loadData() {\r\n            this.totalValue = null\r\n            this.lineChartData[0].data = []\r\n            this.pieChartValues = []\r\n            this.pieChartLabels = []\r\n\r\n            axios.get(`http://localhost:3000/api/assets`)\r\n            .then(resp => {\r\n                let assetData = resp.data\r\n                this.tableData = assetData.filter(e => e.is_deleted == 0)\r\n\r\n                if (assetData.length) {\r\n                    this.totalValue = 0\r\n                    for (let asset of assetData) {\r\n                        if (!asset.is_deleted) {\r\n                            this.pieChartLabels.push(asset.name)\r\n                            this.pieChartValues.push(parseFloat(asset.value))\r\n                            this.totalValue += parseFloat(asset.value)\r\n                        }\r\n                    }\r\n                }\r\n\r\n                this.$store.commit('setTotalAssetValue', this.totalValue)\r\n\r\n                axios.get(`http://localhost:3000/api/assets/history`)\r\n                .then(resp => {\r\n                    this.refineAssets(assetData, resp.data)\r\n                })\r\n            })\r\n            .catch(() => {\r\n                this.$router.push('/404')\r\n            })\r\n        },\r\n\r\n        refineAssets(assetData, history) {\r\n            // Get all individual assets\r\n            let assets = []\r\n            for (let asset of assetData) {\r\n                assets.push({\r\n                    id: asset.id,\r\n                    history: []\r\n                })\r\n            }\r\n\r\n            // Get all dates that there are records for\r\n            let uniqueDates = []\r\n            for (let entry of history) {\r\n                if (!uniqueDates.includes(entry.date)) {\r\n                    uniqueDates.push(entry.date)\r\n                }\r\n            }\r\n            uniqueDates = uniqueDates.sort()\r\n\r\n            // Go through every asset\r\n            for (let asset of assets) {\r\n                for (let date of uniqueDates) {                    \r\n                    // Check if there is any value for that asset on that date, add it if there is.\r\n                    for (let entry of history) {\r\n                        if (entry.date == date && entry.asset_id == asset.id) {\r\n                            asset.history.push({\r\n                                x: entry.date,\r\n                                y: parseFloat(entry.value)\r\n                            })\r\n                        }\r\n                    }\r\n                    // If the asset doesn't have an entry for a date with data, add one with the previous value.\r\n                    if (!asset.history.some(e => e.x == date)) {\r\n                        if (asset.history.length) {\r\n                            asset.history.push({\r\n                                x: date,\r\n                                y: parseFloat(asset.history[asset.history.length - 1].y)\r\n                            })\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Turn the asset data into something the line chart can read\r\n            for (let asset of assets) {\r\n                for (let entry of asset.history) {\r\n                    let i = this.lineChartData[0].data.findIndex(e => e.x == entry.x)\r\n                    if (i < 0) {\r\n                        this.lineChartData[0].data.push(entry)\r\n                    }\r\n                    else {\r\n                        this.lineChartData[0].data[i].y += entry.y\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n})\r\n</script>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}